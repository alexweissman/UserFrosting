{% extends "pages/abstract/fk-base.html.twig" %}

{% block page_title %}Sign In{% endblock %}
{% block content %}
 
<section class="mx-auto w-full">
    <div class="justify-between mx-auto max-w-7xl mt-12 space-y-6 ">
    <div class="rounded-xl bg-gradient-to-r from-[#ACFC7A] via-[#9FF3A9] to-[#9CECD5] p-1 w-full sm:w-full md:w-3/4 lg:w-1/2 mx-auto shadow-lg">
        <div class="bg-gray-50 rounded-lg p-10">
        <h1 class="text-[#331E36] font-semibold text-4xl tracking-tight w-full text-center" style="font-family: 'MangueiraSemiBold';">{{translate('SIGNIN')}}</h1>
        <div id="alerts"></div>
        <div class="form-alerts" id="alerts-page"></div>
        <form action="{{site.uri.public}}/account/login" id="sign-in" method="post" class="flex flex-col space-y-5">
          {% include "forms/csrf.html.twig" %}

          <div class="flex flex-col space-y-2">
            <label for="user_name" class="text-gray-700">User Name</label>
            <input type="text" required="required" class="border border-gray-300 px-2 py-2 rounded-md" placeholder="{% if site.login.enable_email %}{{translate('EMAIL_OR_USERNAME')}}{% else %}{{translate('USERNAME')}}{% endif %}" name="user_name">
          </div>

          <div class="flex flex-col space-y-2">
            <label for="password"  class="text-gray-700">Password</label>
            <input type="password" required="required" class="border border-gray-300 px-2 py-2 rounded-md" placeholder="{{translate('PASSWORD')}}" name="password">
          </div>

          <div class="flex items-center mb-4">
            <input type="checkbox" value="" name="rememberme" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
            <label for="rememberme" class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">{{translate('REMEMBER_ME')}}</label>
          </div>
            <!-- /.col -->
          <button type="submit" id="submitForm" class="px-4 py-2 rounded-md bg-[#331E36]  border border-[#331E36] text-white text-sm font-semibold uppercase tracking-wider w-full transition-colors duration-400 ease-in-out hover:bg-[#5a3560]">
              <p>Sign In</p>
          </button>
          <p id="errorMessage" class="hidden text-red-400">Sorry, your username and password could not be verified. Please try again.</p>
            <!-- /.col -->

        </form>
        <div class="flex flex-col space-y-2 mt-5">
        {% block loginLinks %}
        <a href="{{site.uri.public}}/account/forgot-password" >{{translate('PASSWORD.FORGET')}}</a>
        {% if site.registration.require_email_verification %}
            <a href="{{site.uri.public}}/account/resend-verification" >{{translate('ACCOUNT.VERIFICATION.RESEND')}}</a>
        {% endif %}
        {% if site.registration.enabled %}
            <a href="{{site.uri.public}}/account/register" >{{translate('REGISTER')}}</a>
        {% endif %}
        {% endblock %}
        </div>
        </div>
        </div>
    </div>
  </section>
{% endblock %}

{% block scripts_page %}
    <!-- Include validation rules -->
    <script>
        {% include "pages/partials/page.js.twig" %}
    </script>

    <script>
    site = $.extend(
        true,               // deep extend
        {
            "registration" : {
                "enabled" : "{{site.registration.enabled}}"
            } 
        },
        site
    );
    </script>


    <script>
      const form = document.getElementById("sign-in");

      async function sendData() {
        document.getElementById('errorMessage').classList.add('hidden');
        // Associate the FormData object with the form element

        const formData = new FormData(form);
        
        try {
          const response = await fetch("/account/login", {
          method: "POST",
          // Set the FormData instance as the request body
          body: formData,
          });
          if (response.ok){
            window.location.replace("{{site.uri.public}}/leagues")
          }else{
            document.getElementById('errorMessage').classList.remove('hidden');
          }
          
        } catch (e) {
          //If Couldn't log in:
          window.location.replace("{{site.uri.public}}/account/sign-in");
        } 
      }

      // Take over form submission
      form.addEventListener("submit", (event) => {
        event.preventDefault();
        sendData();
      });
</script>
{% endblock %} 
